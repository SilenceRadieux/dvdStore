package com.simplon.dvdstore.controllers;

import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RestController;

@RestController
public class LoginController {

    @GetMapping("/user")
    public String getUser() {
        return "Welcome, user";
    }

    @GetMapping("/admin")
    public String getAdmin() {
        return "Welcome, admin";
    }

    @GetMapping("/*")
    private StringBuffer getOauth2LoginInfo(Principal user){
    StringBuffer protectedInfo = new StringBuffer();
    OAuth2AuthenticationToken authToken = ((OAuth2AuthenticationToken) user);
    OAuth2AuthorizedClient authClient = this.authorizedClientService.loadAuthorizedClient(authToken.getAuthorizedClientRegistrationId(), authToken.getName());
    return protectedInfo;
    }

    private StringBuffer getUsernamePasswordLoginInfo(Principal user) {
      StringBuffer usernameInfo = new StringBuffer();
      
      UsernamePasswordAuthenticationToken token = ((UsernamePasswordAuthenticationToken) user);
      if(token.isAuthenticated()){
         User u = (User) token.getPrincipal();
         usernameInfo.append("Welcome, " + u.getUsername());
      }
      else{
         usernameInfo.append("NA");
      }
      return usernameInfo;
    }

    private StringBuffer getOauth2LoginInfo(Principal user){
    StringBuffer protectedInfo = new StringBuffer();
    OAuth2AuthenticationToken authToken = ((OAuth2AuthenticationToken) user);
    OAuth2AuthorizedClient authClient = this.authorizedClientService.loadAuthorizedClient(authToken.getAuthorizedClientRegistrationId(), authToken.getName());
    return protectedInfo;
    }

    public LoginController(OAuth2AuthorizedClientService authorizedClientService) {
    this.authorizedClientService = authorizedClientService;
    }

}